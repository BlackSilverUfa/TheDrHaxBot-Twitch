(

$positive := [
    'Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾ Ð´Ð° YEPPERS',
    'Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ²ÐµÑ€ÐµÐ½ Ð² ÑÑ‚Ð¾Ð¼ YEPPERS',
    'Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… ÑÐ¾Ð¼Ð½ÐµÐ½Ð¸Ð¹ YEPPERS',
    'Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð»Ð¸ YEPPERS',
    'Ð½Ñƒ ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾ YEPPERS',
    'Ð´Ð° YEPPERS'
];

$plausible := [
    'Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ðµ ÑˆÐ°Ð½ÑÑ‹ SeemsGood',
    'Ð²ÐµÑ€Ð¾ÑÑ‚Ð½ÐµÐµ Ð²ÑÐµÐ³Ð¾ SeemsGood',
    'Ð´ÑƒÐ¼Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð´Ð° SeemsGood',
    'Ð½Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ SeemsGood',
    'Ð½ÐµÐ¼Ð°Ð»Ð¾Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ SeemsGood'
];

$uncertain := [
    'Ð¿Ð¾ÐºÐ° Ð½Ðµ ÑÑÐ½Ð¾ peepoThink',
    'Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½ peepoThink',
    'Ñ‚ÑƒÑ‚ Ð²ÑÑ‘ Ð½Ðµ Ñ‚Ð°Ðº Ð¾Ð´Ð½Ð¾Ð·Ð½Ð°Ñ‡Ð½Ð¾ peepoThink',
    'ÑÐºÐ°Ð¶Ñƒ Ð·Ð° Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ, BSUDAI',
    'Ð½Ðµ ÑÑ‚Ð¾Ð¸Ñ‚ Ð²ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ñƒ Ñ‚ÐµÐ¼Ñƒ. Ð’Ñ‹ Ð¼Ð¾Ð»Ð¾Ð´Ñ‹Ðµ, ÑˆÑƒÑ‚Ð»Ð¸Ð²Ñ‹Ðµ, Ð²Ð°Ð¼ Ð²ÑÐµ Ð»ÐµÐ³ÐºÐ¾. Ð­Ñ‚Ð¾ Ð½Ðµ Ñ‚Ð¾. ÐŸÐ¾Ð³Ð¸Ð±Ð½ÑƒÑ‚ Ð’Ð¡Ð monkaGunshake'
];

$unplausible := [
    'Ð´Ð° Ð½ÐµÑ‚, Ð½Ð°Ð²ÐµÑ€Ð½Ð¾Ðµ BSUHee',
    'ÑˆÐ°Ð½ÑÑ‹ Ð½Ðµ Ð¾Ñ‡ÐµÐ½ÑŒ BSUHee',
    'ÑÐºÐ¾Ñ€ÐµÐµ Ð½ÐµÑ‚, Ñ‡ÐµÐ¼ Ð´Ð° BSUHee',
    'Ñ Ð±Ñ‹ Ð½Ðµ Ð½Ð°Ð´ÐµÑÐ»ÑÑ BSUHee'
];

$negative := [
    'Ð´Ð°Ð¶Ðµ Ð½Ðµ Ð½Ð°Ð´ÐµÐ¹ÑÑ NOPERS',
    'Ð²ÐµÑÑŒÐ¼Ð° ÑÐ¾Ð¼Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ NOPERS',
    'Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾ Ð½ÐµÑ‚ NOPERS',
    'Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ ÐšÐ ÐÐ™ÐÐ• Ð¼Ð°Ð»Ð° NOPERS',
    'Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð² Ð¶Ð¸Ð·Ð½Ð¸ NOPERS',
    'Ð½ÐµÑ‚, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½ÐµÑ‚ NOPERS'
];

$continuations := [
    'Ð°Ð½Ñ ANYA',
    'Ð°Ð½Ð»Ð°ÐºÐ¸ BSUHee',
    'Ð°Ð»Ð»Ð¾ peepoPhone',
    'Ð°Ð´Ð°, Ñ Ð»ÑŽÐ±Ð»ÑŽ Ñ‚ÐµÐ±Ñ ANYA',
    'Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð»Ð¸ YEPPERS',
    'Ð°Ñ‹Ð°Ñ‹Ð° ANYA',
    'Ð°ÑƒÑ„ ðŸº',
    'Ð°Ð¿Ñ‡Ñ…Ð¸ ANYA',
    'Ð°ÑÑ AYAYA',
    'Ð°Ð³Ð° YEPPERS',
    'ass gachiBASS',
    'Ð°Ð²Ð°Ð²Ð°Ð²Ð° MEGALUL',
    
    'Ð¾Ð¾Ð¾, ÑÐ»Ð´ÐµÐ½ Ñ€Ð¸Ð½Ð³ KOgasm',
    
    'Ð¼Ð¸Ñ„Ð° BibleThump',
    
    'Ð¿Ð¾Ð¿Ð¾Ð»Ð·ÐµÐ½ÑŒ popCat',
    'Ð¿Ð¸Ð¿Ð° PETTHEPEEPO',
    'Ð¿Ð¾Ð¿Ð° peepoGiggles',
    'Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÑŽ YEPPERS',
    'Ð¿Ð¾Ð¿Ð¾Ð»Ð° AYAYA',
    'Ð´ÐµÐ²Ð¾Ð»Ð° AYAYA',
    
    'ÐºÑƒÐ»Ñ-Ð±ÑƒÐ»Ñ ANYA',
    'ÐºÑƒÐ»ÑÐ»Ñ ANYA',
    'ÐºÑƒÐºÑƒ, Ð¸Ð¿Ñ‚Ð° ANYA',
    'ÐºÑƒÐºÑƒÑÐ¸ÐºÐ¸ NomNom'
];

$choose := function ($l) {(
    $id := $floor($random() * $count($l));
    $l[$id]
)};

$choice := function ($x) {
    $choose([
        'ÑÐºÐ¾Ñ€ÐµÐµ Ð²ÑÐµÐ³Ð¾ ' & $x & ' peepoThink',
        'Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾ ' & $x & ' YEPPERS',
        $x & ' â€” Ð½Ð°Ñˆ Ð²Ñ‹Ð±Ð¾Ñ€ SeemsGood',
        'Ð¼Ð½Ðµ ÐºÐ°Ð¶ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ ' & $x & ' peepoThink',
        'ÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾ Ð¶Ðµ ' & $x & ' YEPPERS'
    ])
};

$indexOf := function($list, $item) {
    ($list ~> $map(function($x, $i) {
        $x = $item ? $i : null
    }) ~> $filter(function($x) { $x != null }))[0]
};

$translate := function($text, $from, $to) {(
    $from := $split($from, '');
    $to := $split($to, '');

    $text
        ~> $split('')
        ~> $map(function($x) {(
            $index := $from ~> $indexOf($x);
            $index != null ? $to[$index] : $x
        )})
        ~> $join()
)};

$distinctStr := function ($x) {
    $x ~> $split('') ~> $map(function($y, $i) {
        $y ~> $match(/[Ð°ÐµÐ¾ÑƒÑ‹Ñ]/) and $substring($x, $i + 1, 1) = $y ? '' : $y
    }) ~> $join()
};

$startsWith := function ($x, $y) {(
    $substring($x, 0, $length($y)) = $y
)};

$startsWithAny := function ($x, $list) {
    $map($list, function($y) { $startsWith($x, $y) }) ~>
    $filter(function ($v) { $v = true }) ~> $count > 0
};

$continue := function($text) {(
    $text := $text
        ~> $lowercase
        ~> $translate('a', 'Ð°')
        ~> $distinctStr
        ~> $replace(/\.*$/, '');

    $length($text) = 0 ? null :

    $continuations ~> $map(function($x) {
        $startsWith($x ~> $translate('a', 'Ð°'), $text) ? (
            $substring($x, $length($text))
        ) : null
    }) ~> $filter(function($x) { $x }) ~> $choose
)};

(parsed.query ~> $length = 0) ? (
    $choose([
        'Ñ‡Ñ‚' & (
            $match(payload.message, /!Ñˆ+([Ð°Ð¾]+)Ñ€+/i).groups[0]
            ~> $translate('ÐÐ°ÐžÐ¾', 'ÐžÐ¾ÐÐ°')
        ) & '? Jebaited',
        (
            $match(payload.message, /!Ñˆ+([Ð°Ð¾]+)Ñ€+/i).groups[0]
            ~> $translate('ÐžÐ¾', 'ÐÐ°')
        ) & '? Jebaited'
    ])
) :
(parsed.query ~> $match(/ (Ð¸Ð»Ð¸|or) /)) ? (
    $options := parsed.query
        ~> $substringBefore('?') ~> $replace(/ (Ð¸Ð»Ð¸|or) /, ', ')
        ~> $split(',') ~> $map(function ($i) { $trim($i) });

    $options := $startsWithAny($options[0] ~> $lowercase, [
        'Ð²Ð¾ Ñ‡Ñ‚Ð¾',
        'Ñ‡Ñ‚Ð¾',
        'ÐºÐ°Ðº',
        'Ð³Ð´Ðµ',
        'ÐºÑƒÐ´Ð°',
        'ÐºÐ¾Ð³Ð´Ð°'
    ]) ? $options[[1..$count($options)]] : $options;

    ($count($options) = 2 and 'Ð½Ðµ ' & $options[0] = $options[1]) ? 'Ð²Ð¾Ñ‚ Ð² Ñ‡Ñ‘Ð¼ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Kojimaptyp' :
    ($count($options) = 2 and 'not ' & $options[0] = $options[1]) ? 'that is the question Kojimaptyp' :
    ($count($options) = 2 and $options[0] = $options[1]) ? 'Ð´Ð° YEPPERS' :
    (
        $choice($choose($options))
    );
) :
(parsed.query ~> $match(/Ð¾Ñ‚ [+-]?[0-9]+ Ð´Ð¾ [+-]?[0-9]+/)) ? (
    $range := (parsed.query ~> $match(/Ð¾Ñ‚ ([+-]?[0-9]+) Ð´Ð¾ ([+-]?[0-9]+)/)).groups
        ~> $map(function ($v) { $number($v ~> $replace(/\+/, '')) }) ~> $sort;

    $choice($floor($random() * ($range[1] - $range[0] + 1) + $range[0]))
) :
(parsed.query_filtered ~> $continue) ? (
    '...' & $continue(parsed.query_filtered)
) :
(parsed.query_filtered ~> $match(/^Ð¿Ð¸Ð½Ð³/i)) ? (
    "Ð¿Ð¾Ð½Ð³ Pepega"
) :
(parsed.query ~> $match(/^Ð¼Ð¾Ð¶ÐµÑ‚ Ñ‡Ð°Ð¹ÐºÑƒ/)) ? 'Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ñ‚ÐµÐ±Ñ?! Jebaited' :
(parsed.query ~> $match(/^Ñ‚Ñ‹ Ð¿Ð¾Ñ‚Ñ€ÑÑÐ°ÑŽÑ‰Ð¸Ð¹/)) ? 'Ð½ÐµÑ‚, Ñ‚Ñ‹ Ð¿Ð¾Ñ‚Ñ€ÑÑÐ°ÑŽÑ‰Ð¸Ð¹! keanU' :
(parsed.query ~> $match(/^[UO][wÏ‰v][UO]$/i)) ? $choose(['UÏ‰U', 'Ã²Ï‰Ã³', 'OÏ‰O', 'à² _à² ']) :
(parsed.query ~> $match(/^(PETTHE|(Ð½Ðµ )?Ð¿Ð¸Ð¿(Ð°Ð¹|Ð½Ð¸|\ |$))/)) ? 'Ð¿Ð¸Ð¿ ' & $choose([
    'PETTHEPEEPO',
    'PETTHEAPTEEPO',
    'PETTHECAT',
    'PETTHEEVAN',
    'PETTHEMOD'
]) :
(
    $choose([
        $choose($positive),
        $choose($plausible),
        $choose($uncertain),
        $choose($unplausible),
        $choose($negative)
    ])
)

)
